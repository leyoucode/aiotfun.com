---
import { getLocaleFromUrl, useTranslations, localePath } from '../utils/i18n';
import { getArticles } from '../utils/articles';

const locale = getLocaleFromUrl(Astro.url);
const t = useTranslations(locale);
const allArticles = await getArticles(locale);
const weeklyArticles = allArticles
  .filter((a) => a.tags.includes('weekly'))
  .slice(0, 5);
---

<div class="rounded-card bg-bg-alt p-6">
  <h3 class="mb-4 font-display text-xl font-bold">
    <span class="mr-2 text-accent">â—ˆ</span>
    {t.home.aiot_weekly}
  </h3>

  <ol class="space-y-3">
    {weeklyArticles.map((article, index) => (
      <li class="flex gap-3">
        <span class="font-mono text-sm font-medium text-accent">{index + 1}.</span>
        <div>
          <a href={localePath(`/signals/${article.slug}/`, locale)} class="text-sm font-medium text-text transition-colors hover:text-accent" title={article.title}>
            {article.title}
          </a>
          <span class="ml-2 font-mono text-xs text-text-muted">{article.date}</span>
        </div>
      </li>
    ))}
  </ol>

  {weeklyArticles.length > 0 && (
    <a href={localePath('/signals/', locale)} class="mt-4 inline-block font-body text-sm text-accent transition-colors hover:underline">
      {t.home.see_all_weekly}
    </a>
  )}
</div>
