---
import CategoryTag from './CategoryTag.astro';
import OptimizedImage from './OptimizedImage.astro';
import { getLocaleFromUrl, useTranslations, localePath } from '../utils/i18n';
import type { Article } from '../types/article';

interface Props {
  article: Article;
  variant?: 'featured' | 'large' | 'medium' | 'small';
}

const { article, variant = 'medium' } = Astro.props;
const locale = getLocaleFromUrl(Astro.url);
const t = useTranslations(locale);
const href = localePath(`/${article.category}/${article.slug}/`, locale);

const isFeatured = variant === 'featured';
const isLarge = variant === 'large';
const isSmall = variant === 'small';
---

{isFeatured ? (
  <!-- Featured 卡片：图片铺满 + 文字叠在底部渐变上 -->
  <a href={href} class="group relative block h-80 md:h-[400px] overflow-hidden rounded-card shadow-card transition-shadow hover:shadow-md">
    <OptimizedImage
      src={article.cover}
      alt={article.title}
      class="absolute inset-0 h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
      widths={[600, 800, 1200, 1600]}
      sizes="100vw"
      loading="lazy"
    />
    <div class="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent p-4 md:p-6 pt-20">
      <div class="mb-2">
        <CategoryTag category={article.category} />
      </div>
      <h3 class="font-body text-xl md:text-2xl font-bold leading-snug text-white group-hover:text-white/90 transition-colors line-clamp-2" title={article.title}>
        {article.title}
      </h3>
      <p class="mt-2 text-sm md:text-base text-white/80 line-clamp-2" title={article.description}>
        {article.description}
      </p>
      <div class="mt-3 flex items-center gap-2 font-mono text-xs text-white/60">
        <span>{article.date}</span>
        <span>·</span>
        <span>{article.readingTime} {t.article.min_read}</span>
      </div>
    </div>
  </a>
) : (
  <!-- 普通卡片变体 -->
  <a href={href} class="group block overflow-hidden rounded-card border border-border bg-card-bg shadow-card transition-shadow hover:shadow-md">
    <div class:list={[
      'overflow-hidden',
      isSmall ? 'h-28' : isLarge ? 'h-56' : 'h-44',
    ]}>
      <OptimizedImage
        src={article.cover}
        alt={article.title}
        class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
        widths={[300, 400, 600]}
        sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 400px"
        loading="lazy"
      />
    </div>
    <div class:list={[isSmall ? 'p-3' : 'p-4']}>
      <div class="mb-2">
        <CategoryTag category={article.category} />
      </div>
      <h3 class:list={[
        'font-body font-bold leading-snug text-text group-hover:text-accent transition-colors line-clamp-2',
        isSmall ? 'text-sm' : isLarge ? 'text-lg' : 'text-base',
      ]} title={article.title}>
        {article.title}
      </h3>
      {!isSmall && (
        <p class="mt-2 text-sm text-text-muted line-clamp-2" title={article.description}>
          {article.description}
        </p>
      )}
      <div class="mt-3 flex items-center gap-2 font-mono text-xs text-text-muted">
        <span>{article.date}</span>
        <span>·</span>
        <span>{article.readingTime} {t.article.min_read}</span>
      </div>
    </div>
  </a>
)}
